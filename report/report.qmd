---
title: "ECON832 Final: Mini Paper"
author: "Daniel Sánchez Pazmiño"
date: "2024-04-24"
date-format: "MMMM YYYY"
output-file: "SANCHEZ_Daniel_final_minipaper.pdf"
format: pdf # Change to html if LaTeX not installed or causing issues
execute:
    echo: false
    warning: false
    message: false
fig-align: center
fig-cap-location: top
number-sections: true
bibliography: references.bib
header-includes:
    - \usepackage{float}
    - \usepackage{amsmath, amsfonts, amssymb, amsthm}
    - \usepackage[margin = 1in]{geometry}
---

```{julia}
#| include: false
#=
To compile this Quarto notebook, run the following in the terminal:
using Pkg
Pkg.add("IJulia")
using IJulia
notebook()
Needs tinytex or a full LaTeX distribution for PDF output, change format to html or docx if not available
=#
using Pkg
Pkg.activate("final_env")
```

# Overview 

The data comes from the CPC18 [@plonsky_etal17], which consists of experiments involving various decision makers choosing between two lotteries. I focus on the newer data exclusive to CPC18 (Experiment 1), which added feedback and attention features to the CPC15 data. 

This experiment involved sixty choice problems for 240 participants. Two sets of problems were implemented, where participants faced one set of thirty problems. Each problem was faced for 25 trials, where the first five trials did not provide feedback about forgone and obtained payoffs. A trial involved choosing between two options, where each option (A or B) involved an underlying lottery with a probability distribution [@plonsky_etal18]. I use the calibration data set to train the DFNNs and the **individual track data** (Track II) to test the model.

# Methodology

## Data preparation

The calibration dataset was filtered to only include Experiment 1 data. The outcome variable was the binary indicator of the choice of B over A. Since the variable was already dichotomous, no transformation was needed. I include demographic variables in the baseline models: location, gender and age. For location and gender, I dichotomized the variables with Technion and male as the reference levels. 

Risk features which are considered include the shapes of the distributions for lotteries A and B. These involve the number of lottery outcomes, the expected values, the low payoffs, and probabilities to draw from the lotteries and lot distribution shapes. The latter defines the distribution of the lotteries, which can be binomial around the expected value, right skewed or left skewed. The shape of the lotteries where dichotomized in the same way as the location and gender variables; all other variables are continuous. The variance, while not directly observed, is a function of these variables.

Other relevant variables involve whether there is ambiguity in the probabilities or if there is aa correlation between the payoffs. Further, it is important to include trial numbers, potential and obtained payoffs obtained, and forgone payoffs. Some of these variables are categorical, but they are already dichotomized, so I didn't transform them.

Regarding attention features, I include the number of time block, reaction time, feedback binary outcome, the onscreen button and the trial number within a game. 

The processing of the calibration dataset was done using `TidierData.jl` and `DataFrames.jl`. I performed a test-train split with 80% of the data used for training and 20% for testing. I further tested with the individual track data @plonsky_etal_comp_ind. 

## Feature engineering

As mentioned, all categorical variables for both the risk and attention features were dichotomized. This is equivalent to **one-hot encoding**. The continuous variables were **standardized** to have a mean of zero and a standard deviation of one.

The data was processed from its rectangular form (every row per decision) to a format where each row represented an attribute, and every column represented a decision.

## Model configuration

The model is a deep feedforward network neural network (DFNN) with `Flux.jl`. I use a ReLU activation function for the input and hidden layers and a sigmoid activation function for the output layer. The sigmoid function is commonly used for binary classification problems, as it squashes its input values to be between 0 and 1, which can be interpreted as probabilities.

I use mean squared error as the loss function and the ADAM optimizer to minimize the loss function. The learning rate was set to 0.5. I use a confusion matrix and an accuracy rate (percent correctly predicted) to evalute the model's fit. 

# Feature analysis

## Risk features

A correlation analysis was performed to identify the most relevant features. The correlation matrix shows that the number of outcomes, the low payoff of lotteries, the correlation between two possible options and the shape of the distribution are the most relevant features. 

The correlation between the number of outcomes and the choice for the B lottery is 0.09, which is statistically significant at the 1% level. This means that more outcomes in the B lottery are associated with a higher probability of choosing B. The correlation between the low payoff of the lotteries and the choice for the B lottery is 0.11, which is statistically significant at the 1% level. This means that higher low payoffs in the B lottery are associated with a higher probability of choosing B. This might be a result of the risk aversion of the participants, which is a common feature in decision-making and point towards the importance of considering risk-aversion in the model rather than risk neutrality (since the expected value is not correlated). The correlation between lotteries shows a relationship with the choice of B, with negative correlation of -0.14, which is statistically significant at the 1% level. This means that the correlation between the payoffs of the lotteries is associated with a lower probability of choosing B. Again, this might point toward risk aversion, as the correlation between payoffs might be seen as a riskier option. 

In terms of the shape of the distribution, I identify that a symmetric distribution greatly favours the choice of B, as seen below. Further, I also identify that the payoff that the payoff that the participant received shows a statistically significant correlation with the choice of B. I choose to include all 12 variables which jointly define the shape of the distribution in the model, as well as the payoff that the participant received plus the potential payoffs of A and B. 

:::{#fig-barplot}

![](../figures/barplot_by_lotshape.png){height=7cm}

Choice of lottery by shape of distribution
:::

## Attention features

# References {.unnumbered}

:::{.refs}

:::